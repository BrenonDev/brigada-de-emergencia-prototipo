<!DOCTYPE html>
<!-- Define que este documento √© HTML5 -->

<html lang="pt-BR">
<!-- In√≠cio do HTML e define o idioma como portugu√™s do Brasil -->

<head>
<meta charset="UTF-8">
<!-- Define codifica√ß√£o de caracteres (acentos funcionam corretamente) -->

<title>Central de Emerg√™ncia Institucional</title>
<!-- T√≠tulo da aba do navegador -->

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Faz o layout se adaptar ao tamanho da tela (responsivo) -->

<style>
/* Define vari√°veis globais de cores */
:root{
  --vermelho: #b00020;
  --vermelho-claro: #e53935;
  --cinza-escuro: #1f1f1f;
  --cinza: #2b2b2b;
  --branco: #ffffff;
}

/* Aplica box-sizing e fonte padr√£o a todos os elementos */
*{
  box-sizing: border-box;
  font-family: Arial, Helvetica, sans-serif;
}

/* Estilo geral do corpo da p√°gina */
body{
  margin: 0;
  min-height: 100dvh;
  background: linear-gradient(180deg, #1a1a1a, #000000);
  display: flex;
  justify-content: center;
  align-items: center;
}

/* Estilo da caixa principal */
.container{
  width: 90%;
  max-width: 420px;
  background: var(--cinza);
  border-radius: 14px;
  padding: 25px 20px 30px;
  text-align: center;
  box-shadow: 0 0 25px rgba(255,0,0,0.2);
  border: 2px solid var(--vermelho);
}

/* Estilo do √≠cone de sirene */
.logo{
  font-size: 40px;
  margin-bottom: 5px;
}

/* Estilo do t√≠tulo */
h1{
  color: var(--branco);
  font-size: 1.6em;
  margin-bottom: 8px;
}

/* Estilo do texto descritivo */
p{
  color: #cccccc;
  font-size: 0.95em;
  margin-bottom: 25px;
}

/* Estilo dos bot√µes */
.btn{
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  width: 100%;
  padding: 16px;
  margin: 10px 0;
  border-radius: 10px;
  text-decoration: none;
  font-size: 1em;
  font-weight: bold;
  color: var(--branco);
  background: linear-gradient(135deg, var(--vermelho), var(--vermelho-claro));
  transition: transform 0.2s, box-shadow 0.2s, opacity 0.2s;
  box-shadow: 0 4px 10px rgba(0,0,0,0.5);
}

/* Efeito ao passar o mouse nos bot√µes */
.btn:hover{
  transform: scale(1.03);
  box-shadow: 0 6px 15px rgba(255,0,0,0.6);
  opacity: 0.95;
}

/* Estilo do rodap√© */
.footer{
  margin-top: 20px;
  font-size: 0.75em;
  color: #aaaaaa;
}
</style>
</head>

<body>

<div class="container">
  <!-- √çcone de alerta -->
  <div class="logo">üö®</div>

  <!-- T√≠tulo -->
  <h1>Bot√µes de Emerg√™ncia</h1>

  <!-- Texto explicativo -->
  <p>Toque no bot√£o correspondente para acionar o servi√ßo desejado imediatamente.</p>

  <!-- Bot√£o que liga para Seguran√ßa Interna -->
  <a class="btn" href="tel:+5511999990001">
    üìû Seguran√ßa Interna
  </a>

  <!-- Bot√£o que liga para Enfermaria -->
  <a class="btn" href="tel:+5511999990002">
    üè• Enfermaria / Primeiros Socorros
  </a>

  <!-- Bot√£o que chama fun√ß√£o JavaScript -->
  <a class="btn" onclick="enviarAlertaParaTodos()">
    üöí Corpo de Bombeiros
  </a>

  <!-- Bot√£o que liga para a pol√≠cia -->
  <a class="btn" href="tel:190">
    üöì Pol√≠cia Militar (190)
  </a>

  <!-- Bot√£o que liga para manuten√ß√£o -->
  <a class="btn" href="tel:+5511999990002">
    ‚ö° Manuten√ß√£o Predial de Emerg√™ncia
  </a>

  <!-- Rodap√© -->
  <div class="footer">
    Sistema de resposta r√°pida institucional
  </div>
</div>

<script>
/* Lista de n√∫meros que receber√£o a mensagem */
const contatos = [
  "5515996287208",
  "5515988221498"
];

/* Contador de tentativas de localiza√ß√£o */
let tentativa = 0;

/* N√∫mero m√°ximo de tentativas */
const maxTentativas = 30;

/* Precis√£o m√≠nima desejada (em metros) */
let precisaoAceitavel = 1;

/* Fun√ß√£o chamada ao clicar no bot√£o */
function enviarAlertaParaTodos() {
  tentativa = 0;             // zera tentativas
  precisaoAceitavel = 1;     // reseta precis√£o
  obterLocalizacaoPrecisa(); // inicia busca da localiza√ß√£o
}

/* Fun√ß√£o que tenta obter a localiza√ß√£o */
function obterLocalizacaoPrecisa() {

  // Verifica se o navegador suporta GPS
  if (!navigator.geolocation) {
    alert("Geolocaliza√ß√£o n√£o suportada.");
    return;
  }

  tentativa++; // soma 1 tentativa

  navigator.geolocation.getCurrentPosition(
    pos => {
      // Captura latitude
      const lat = pos.coords.latitude;

      // Captura longitude
      const lon = pos.coords.longitude;

      // Captura precis√£o em metros
      const accuracy = pos.coords.accuracy;

      console.log("Tentativa:", tentativa, "Precis√£o:", accuracy);

      // Se atingiu a precis√£o ou estourou tentativas
      if (accuracy <= precisaoAceitavel || tentativa >= maxTentativas) {
        dispararWhatsApp(lat, lon, accuracy);
      } else {
        precisaoAceitavel += 1; // aceita erro maior
        setTimeout(obterLocalizacaoPrecisa, 3000); // tenta de novo
      }
    },

    err => {
      console.log("Erro localiza√ß√£o:", err);

      if (tentativa < maxTentativas) {
        setTimeout(obterLocalizacaoPrecisa, 3000);
      } else {
        alert("N√£o foi poss√≠vel obter localiza√ß√£o precisa.");
      }
    },

    {
      enableHighAccuracy: true,
      timeout: 60000,
      maximumAge: 0
    }
  );
}

/* Fun√ß√£o que cria a mensagem */
function dispararWhatsApp(lat, lon, accuracy) {
  const linkMapa = `https://maps.google.com/?q=${lat},${lon}`;

  const mensagem = 
`üö® PEDIDO DE AJUDA üö®
Preciso de ajuda agora!
Minha localiza√ß√£o:
${linkMapa}
Precis√£o aproximada: ${Math.round(accuracy)} metros.`;

  abrirChatsSequencialmente(mensagem);
}

/* Fun√ß√£o que abre os contatos um por um */
function abrirChatsSequencialmente(mensagem) {
  let i = 0;

  function abrirProximo() {
    if (i >= contatos.length) return;

    const url = `https://wa.me/${contatos[i]}?text=${encodeURIComponent(mensagem)}`;
    window.open(url, "_blank");

    i++;
    setTimeout(abrirProximo, 5000);
  }

  abrirProximo();
}
</script>
</body>
</html>
